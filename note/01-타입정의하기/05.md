# 자바스크립트 this 이해하기

타입스크립트에서 this를 타입지정하는 법을 알기 전에 

자바스크립트에서의 this를 먼저 이해하자

```js
function Counter() {
  this.value = 0;
  // 여기서 this는 counter라는 인스턴스
  this.add = amount => {
    this.value += amount;
    console.log(this)
  };
}
// new 를 이용해서 instance 생성
// 이렇게 new 키워드를 이용해서 호출하면
// Counter 내부에 정의된 this는 instance를 가리키게 된다(counter)
const counter = new Counter();
console.log(counter) // value, add를 프로퍼티롤 갖고 있음
console.log(counter.value);
counter.add(5);
console.log(counter.value);
const add = counter.add;
// 화살표함수의 this.는 해당화살표 함수가 생성될 당시 상위 스코프의 함수나 클래스의 this를 가리킨다.
add(5);
console.log(counter.value);

function Counter2() {
  this.value = 0;
  // 일반함수로 정의
  this.add = function (amount) {
    // 이 this는 달라진다.
    this.value += amount;
    console.log(this === global);
  }
}

const counter2 = new Counter2();
console.log(counter2.value);
// 여기서 add함수를 호출한 주체는 counter2
counter2.add(5);
console.log(counter2.value);
const add2 = counter2.add;
// add2가 호출될 때 this가 가리키는 게 counter2가 아님
// 일반함수의 this는 해당 함수를 호출한 주체를 가리킨다.
// 여기서 함수를 호출한 주체는 전역객체(브라우저 : window = node.js : global)
add2(5);
console.log(counter2.value);

// 화살표 함수의 this는 생성될 당시의 this로 고정되기 때문에 정적이라고 볼 수 있고 일반함수의 this는 호출될 당시의 환경에 따라 달라지기 때문에 동적이라고 볼 수 있다.

// 클래스에서도 마찬가지임
class Counter3 {
  value = 0;
  // 일반함수일 때는 this가 동적으로 정의
  add(amount) {
    this.value += amount;
  }
  // 화살표 함수일 때는 this가 항상 Counter3의 객체로 고정
  add2 = (amount) => {
    this.value += amount;
  }
}

const counter3 = {
  value: 0,
  add: function (amount) {
    this.value += amount;
  }
}
console.log(counter3.value);
// 일반함수 add가 호출될 당시 주체는 counter3이기 때문에
// this는 counter3를 가리킨다.
counter3.add(5);
console.log(counter3.value);
const add3 = counter3.add;
console.log(add3)
// 일반함수 add3가 호출될 당시 주체는 전역객체
add3(5);
console.log(counter3.value)

// const counter3 = {
//   value: 0,
//   add: (amount) => {
//     // 여기서 this는 화살표함수를 감싸고 있는 일반 함수가 없기 때문에  항상 전역객체
//     this.value += amount;
//   }
// }
// console.log(counter3.value);
// counter3.add(5);
// console.log(counter3.value);
// const add3 = counter3.add;
// add3(5);
// console.log(counter3.value)
```

### 정리

- 일반함수
  - 해당 함수를 호출하는 주체에 따라서 this가 달라진다.
- 화살표함수
  - 해당 함수가 생성될 당시 상위 스코프의 함수, 클래스의 this로 고정 바인딩 된다.. 기본적으로는 this 바인딩 없이 전역격체
